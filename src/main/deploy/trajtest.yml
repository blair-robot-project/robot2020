---

# IntelliJ supports Ctrl+clicking anchors to find usages and declarations... so, hyperlinks! Yooooooooo!
# Basically a table of contents; Ctrl+click on a heading in UPPER_SNAKE_CASE to jump back and forth between the
# table of contents and actual location in the map.
NAVIGATION:
  # The anchors that replace map key values must have the values of the keys that they replace.
  - &PDP pdp
  # This works magically because the anchor refers to the key of the mapping only, which is the string "subsystems".
  - &SUBSYSTEMS subsystems:
      # Other anchors, like these, become null list items and are explicitly ignored using @JsonInclude
      - &DRIVE_SUBSYSTEM
  - &COMMANDS commands:
      - &DEFAULT_COMMANDS defaultCommands:
          - &DRIVE_DEFAULT_COMMAND
      - &BUTTONS buttons:
      - &AUTO_COMMANDS autoStartupCommand:
          - &TRAJ_TEST_COMMAND
  - &UPDATER updater

# Anchors for transclusion into the rest of the map.
# Ignored by Jackson (so is NAVIGATION); can contain any valid YAML suitable for organizational purposes.
# Make sure there aren't any colons after the anchors; Jackson gives "Null key for a Map not allowed in JSON"
CONSTANTS:
  - MotorPorts:
      # Spinnyboiz
      - &leftMasterPort 1
      - &leftMasterSlave1Port 2
      - &leftMasterSlave2Port 3
      - &rightMasterPort 4
      - &rightMasterSlave1Port 12
      - &rightMasterSlave2Port 6
  - JoystickPorts:
      - &driveJoystickPort 1
      - &mechanismsJoystickPort 2

# WHETHER TO USE THE CAMERA SERVER
useCameraServer: false

########################################################################################################################
*PDP:
  org.usfirst.frc.team449.robot.jacksonWrappers.PDP:
    '@id': PDP
    canID: 0
    voltagePerCurrentLinReg:
      bufferSize: 250
      rSquaredThreshhold: 0.75


########################################################################################################################
*SUBSYSTEMS:
  #***********************************************************************************************************************
  - *DRIVE_SUBSYSTEM
  - org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
      '@id': drive
      #Wheelbase: 2.14
      leftMaster:
        org.usfirst.frc.team449.robot.generalInterfaces.SmartMotor:
          &Left_Master
          '@id': leftMaster
          type: TALON
          name: left
          port: *leftMasterPort
          PDP:
            org.usfirst.frc.team449.robot.jacksonWrappers.PDP: PDP
          voltagePerCurrentLinReg:
            bufferSize: 250
            rSquaredThreshhold: 0.75
          reverseOutput: true
          reverseSensor: false
          enableBrakeMode: true
          postEncoderGearing: 0.13333333333
          unitPerRotation: 0.4787787 #meters per rotation
          currentLimit: 35
          enableVoltageComp: true
          feedbackDevice: QuadEncoder
          encoderCPR: 256
          startingGear: LOW
          perGearSettings:
            - &Low_Gear
              gear: LOW
              maxSpeed: 2.2
              kP: 0.2
              feedForwardCalculator:
                org.usfirst.frc.team449.robot.jacksonWrappers.FeedForwardCalculators.MappedFeedForwardCalculator:
                  kS: 1.2
                  kV: 4.59
                  kA: 0.599
            - &High_Gear
              gear: HIGH
              maxSpeed: 5
              kP: 0.6
              feedForwardCalculator:
                org.usfirst.frc.team449.robot.jacksonWrappers.FeedForwardCalculators.MappedFeedForwardCalculator:
                  #these constants need to be redone
                  kS: 1.11
                  kV: 2.04
                  kA: 0.637
          updaterProcessPeriodSecs: 0.005
          statusFrameRatesMillis: !!map
            Status_4_AinTempVbat: 15
          slaveVictors:
            - port: *leftMasterSlave1Port
              invertType: FollowMaster
            - port: *leftMasterSlave2Port
              invertType: FollowMaster
      rightMaster:
        org.usfirst.frc.team449.robot.generalInterfaces.SmartMotor:
          <<: *Left_Master
          '@id': rightMaster
          name: right
          port: *rightMasterPort
          reverseOutput: false
          reverseSensor: false
          perGearSettings:
            - <<: *Low_Gear
              feedForwardCalculator:
                org.usfirst.frc.team449.robot.jacksonWrappers.FeedForwardCalculators.MappedFeedForwardCalculator:
                  kS: 1.21
                  kV: 4.68
                  kA: 0.708
            - <<: *High_Gear
              feedForwardCalculator:
                org.usfirst.frc.team449.robot.jacksonWrappers.FeedForwardCalculators.MappedFeedForwardCalculator:
                  kS: 1.15
                  kV: 2.05
                  kA: 0.788
          slaveVictors:
            - port: *rightMasterSlave1Port
              #inverted: false
            - port: *rightMasterSlave2Port
              #inverted: false
      startingOverrideAutoshift: false
      ahrs:
        org.usfirst.frc.team449.robot.jacksonWrappers.MappedAHRS:
          '@id': navX
          port: kMXP
          invertYaw: true
      trackWidthMeters: 0.646523339274361
      shiftComponent:
        org.usfirst.frc.team449.robot.components.ShiftComponent:
          '@id': driveShiftComponent
          otherShiftables:
            - org.usfirst.frc.team449.robot.generalInterfaces.SmartMotor:
                leftMaster
            - org.usfirst.frc.team449.robot.generalInterfaces.SmartMotor:
                rightMaster
          piston:
            '@id': driveShifter
            module: 0
            forward: 1
            reverse: 0
          startingGear: LOW

  #***********************************************************************************************************************

*COMMANDS:
    ########################################################################################################################
  *DEFAULT_COMMANDS:
    #***********************************************************************************************************************
    - *DRIVE_DEFAULT_COMMAND
    - subsystem:
        org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
          drive
      command:
        org.usfirst.frc.team449.robot.drive.unidirectional.commands.UnidirectionalNavXShiftingDefaultDrive:
          '@id': defaultDriveCommand
          kP: 0.003
          kI: 0.0
          kD: 0.05
          maximumOutput: 1
          absoluteTolerance: 0
          deadband: 2
          maxAngularVelToEnterLoop: 3
          inverted: false
          highGearAngularCoefficient: 3
          rampComponent:
            org.usfirst.frc.team449.robot.generalInterfaces.doubleUnaryOperator.RampComponent:
              maxIncreasePerSecond: 3
              maxDecreasePerSecond: 1.5
          driveStraightLoopEntryTimer:
            '@id': driveStraightLoopEntryTimer
            bufferTimeSeconds: 0.15
          subsystem:
            org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
              drive
          oi:
            org.usfirst.frc.team449.robot.oi.unidirectional.arcade.OIArcadeWithDPad:
              '@id': oi
              gamepad:
                org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
                  '@id': driverGamepad
                  port: 1
              rotThrottle:
                org.usfirst.frc.team449.robot.oi.throttles.ThrottlePolynomial:
                  &rotThrottle
                  '@id': rotThrottle
                  stick: driverGamepad
                  axis: 0
                  smoothingTimeSecs: 0.04
                  deadband: 0.08
                  inverted: false
                  polynomial:
                    org.usfirst.frc.team449.robot.generalInterfaces.doubleUnaryOperator.Polynomial:
                      '@id': rotPoly
                      powerToCoefficientMap: !!map
                        1: .5
                        3: .5
                  scale: .7
              fwdThrottle:
                org.usfirst.frc.team449.robot.oi.throttles.ThrottleSum:
                  '@id': fwdThrottle
                  throttles:
                    - org.usfirst.frc.team449.robot.oi.throttles.ThrottlePolynomial:
                        <<: *rotThrottle
                        '@id': posThrottle
                        axis: 3
                        inverted: false
                        deadband: 0.05
                        polynomial:
                          org.usfirst.frc.team449.robot.generalInterfaces.doubleUnaryOperator.Polynomial:
                            '@id': posPoly
                            powerToCoefficientMap: !!map
                              1: 2
                              3: 1
                    - org.usfirst.frc.team449.robot.oi.throttles.ThrottlePolynomial:
                        <<: *rotThrottle
                        '@id': negThrottle
                        axis: 2
                        inverted: true
                        deadband: 0.05
                        polynomial:
                          org.usfirst.frc.team449.robot.generalInterfaces.doubleUnaryOperator.Polynomial:
                            '@id': negPoly
                            powerToCoefficientMap: !!map
                              1: 2
                              3: 1
              invertDPad: false
              dPadShift: 0.1
              turnInPlaceRotScale: 1
              rescaleOutputs: true
              scaleRotByFwdPoly:
                org.usfirst.frc.team449.robot.generalInterfaces.doubleUnaryOperator.Polynomial:
                  '@id': scaleRotByFwdPoly
                  powerToCoefficientMap: !!map
                    0.5: 0.4
                    0: 0.2
                    #1 : 0.25
                    #2: 0.25
          autoshiftComponent:
            '@id': autoshiftComponent
            upshiftSpeed: 1.5
            downshiftSpeed: 1
            upshiftDebouncer:
              '@id': upshiftDebouncer
              bufferTimeSeconds: 0.06
            upshiftFwdThresh: 0.4

  *BUTTONS:
    - button:
        org.usfirst.frc.team449.robot.oi.buttons.SimpleButton:
          '@id': turnToAngleButton
          joystick:
            org.usfirst.frc.team449.robot.jacksonWrappers.MappedJoystick:
              '@id': mechanismsJoystick
              port: *mechanismsJoystickPort
          buttonNumber: 1 #shoulder right
      command:
        org.usfirst.frc.team449.robot.generalInterfaces.limelight.commands.ScanThenTurn:
          '@id': scanThenTurnCommand
          scannerPipe: 1
          turnCommand:
            org.usfirst.frc.team449.robot.drive.unidirectional.commands.AHRS.NavXTurnToAngleLimelight:
              '@id': turnToAngleCommand
              absoluteTolerance: 3
              kP: .01
              drive:
                org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
                  drive
              timeout: 100
              limelight:
                org.usfirst.frc.team449.robot.generalInterfaces.limelight.Limelight:
                  '@id': limelight
                  driverPipeline: 1
          driverPipe: 0
      #        org.usfirst.frc.team449.robot.drive.unidirectional.commands.AHRS.NavXTurnToAngleRelative:
      #          '@id': turnToAngleCommand
      #          absoluteTolerance: 3
      #          kP: 0.01
      #          drive:
      #            org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
      #              drive
      #          timeout: 100
      #          setpoint: 40
      action: WHEN_PRESSED

  *AUTO_COMMANDS:
    - *TRAJ_TEST_COMMAND
    - edu.wpi.first.wpilibj2.command.SequentialCommandGroup:
        '@id': trajTestCommandGroup
        requiredSubsystems:
          - org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
              drive
        commands:
          - org.usfirst.frc.team449.robot.drive.unidirectional.commands.motionprofiling.RamseteControllerGoToPosition:
              &driveconfig
              '@id': testDriveCommand
              drivetrain:
                org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable:
                  drive
              leftPidController:
                org.usfirst.frc.team449.robot.jacksonWrappers.MappedPIDController:
                  Kp: 5
                  name: "left"
              rightPidController:
                org.usfirst.frc.team449.robot.jacksonWrappers.MappedPIDController:
                  Kp: 5
                  name: "right"
              maxSpeedMeters: 1.5
              maxAccelMeters: 1
              maxCentripetalAcceleration: 1
              endingPose:
                translation:
                  x: 2
                  y: -1
                rotation:
                  radians: -1.571
              reversed: false
          - org.usfirst.frc.team449.robot.drive.unidirectional.commands.motionprofiling.RamseteControllerGoToPosition:
              <<: *driveconfig
              '@id': testDriveCommand2
              endingPose:
                translation:
                  x: 2.5
                  y: -0.5
                rotation:
                  radians: -3.14
              reversed: true
          - org.usfirst.frc.team449.robot.drive.unidirectional.commands.motionprofiling.RamseteControllerGoToPosition:
              <<: *driveconfig
              '@id': testDriveCommand3
              endingPose:
                translation:
                  x: 0
                  y: -1
                rotation:
                  radians: -3.14
              reversed: false

########################################################################################################################
*UPDATER:
  org.usfirst.frc.team449.robot.other.Updater:
    '@id': updater
    updatables:
      - org.usfirst.frc.team449.robot.drive.unidirectional.DriveUnidirectionalWithGyroShiftable: drive
      - org.usfirst.frc.team449.robot.oi.unidirectional.arcade.OIArcadeWithDPad: oi
      - org.usfirst.frc.team449.robot.jacksonWrappers.MappedAHRS: navX
      - org.usfirst.frc.team449.robot.jacksonWrappers.PDP: PDP
